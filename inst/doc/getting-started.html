<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Matthew Cornell" />

<meta name="date" content="2022-04-04" />

<title>Getting Started</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Getting Started</h1>
<h4 class="author">Matthew Cornell</h4>
<h4 class="date">2022-04-04</h4>



<div id="getting-started-with-zoltr" class="section level1">
<h1>Getting Started with zoltr</h1>
<p>zoltr is an R package that simplifies access to the <a href="https://www.zoltardata.com/">zoltardata.com</a> API. This vignette
takes you through the package’s main features. So that you can
experiment without needing a Zoltar account, we use the example project
from <a href="https://docs.zoltardata.com/">docs.zoltardata.com</a>,
which should always be available for public read-only access.</p>
</div>
<div id="setting-up-your-account" class="section level1">
<h1>Setting up your account</h1>
<p>You need to have an account on Zoltar and be authenticated to the
server in order to access data from the API. Once you have an account,
we recommend storing your Zoltar username and password in your .Renviron
file. In practice this means having a file named <code>.Renviron</code>
in your home directory. (You can read more about R and environment
variables <a href="https://db.rstudio.com/best-practices/managing-credentials/#use-environment-variables">here</a>.)
The lines of code in this vignette will work if you have the following
two lines somewhere in your <code>.Renviron</code> file (where you
replace your username and password in the appropriate locations). Note
there is no space around the <code>=</code> sign:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="va">Z_USERNAME</span><span class="op">=</span>insert-your-username-here</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="va">Z_PASSWORD</span><span class="op">=</span>insert-your-password-here</span></code></pre></div>
<p>Note that the Zoltar service uses a “token”-based scheme for
authentication. These tokens have a five-minute expiration for security,
which requires re-authentication after that period of time. The zoltr
library takes care of re-authenticating as needed by passing your
username and password back to the server to get another token. Note that
the connection object returned by the <code>new_connection</code>
function stores a token internally, so be careful if saving that object
into a file.</p>
<div id="connect-to-the-host-and-authenticate" class="section level2">
<h2>Connect to the host and authenticate</h2>
<p>The starting point for working with Zoltar’s API is a
<code>ZoltarConnection</code> object, obtained via the
<code>new_connection</code> function. Most zoltr functions take a
<code>ZoltarConnection</code> along with the API <em>URL</em> of the
thing of interest, e.g., a project, model, or forecast. API URLs look
like <code>https://www.zoltardata.com/api/project/3/</code>, which is
that of the “Docs Example Project”. An important note regarding
URLs:</p>
<pre><code>zoltr&#39;s convention for URLs is to require a trailing slash character (&#39;/&#39;) on all URLs. The only exception is the optional `host` parameter passed to `new_connection()`. Thus, `https://www.zoltardata.com/api/project/3/` is valid, but `https://www.zoltardata.com/api/project/3` is not.</code></pre>
<p>You can obtain a URL using some of the <code>*_info</code> functions,
and you can always use the web interface to navigate to the item of
interest and look at its URL in the browser address field. Keep in mind
that you’ll need to add <code>api</code> to the browsable address, along
with the trailing slash character. For example, if you browsed the
<em>Docs Example Project</em> project at (say)
<code>https://www.zoltardata.com/project/3</code> then its API for use
in zoltr would be
<code>https://www.zoltardata.com/api/project/3/</code>.</p>
<!-- run but don't show. NB: will run only if above eval=TRUE -->
<!-- run but don't show. NB: will run only if above eval=TRUE -->
<!-- show but don't run-->
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(zoltr)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>zoltar_connection <span class="ot">&lt;-</span> <span class="fu">new_connection</span>()</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">zoltar_authenticate</span>(zoltar_connection, <span class="fu">Sys.getenv</span>(<span class="st">&quot;Z_USERNAME&quot;</span>), <span class="fu">Sys.getenv</span>(<span class="st">&quot;Z_PASSWORD&quot;</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>zoltar_connection</span></code></pre></div>
</div>
<div id="get-a-list-of-all-projects-on-the-host" class="section level2">
<h2>Get a list of all projects on the host</h2>
<p>Now that you have a connection, you can use the
<code>projects()</code> function to get all projects as a
<code>data.frame</code>. Note that it will only list those that you are
authorized to access, i.e., all public projects plus any private ones
that you own or are a model owner.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>the_projects <span class="ot">&lt;-</span> <span class="fu">projects</span>(zoltar_connection)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">str</span>(the_projects)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    13 obs. of  8 variables:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;  $ id         : int  44 239 316 218 238 4 360 299 328 41 ...</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt;  $ url        : chr  &quot;https://www.zoltardata.com/api/project/44/&quot; &quot;https://www.zoltardata.com/api/project/239/&quot; &quot;https://www.zoltardata.com/api/project/316/&quot; &quot;https://www.zoltardata.com/api/project/218/&quot; ...</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;  $ owner_url  : chr  &quot;https://www.zoltardata.com/api/user/22/&quot; &quot;https://www.zoltardata.com/api/user/108/&quot; &quot;https://www.zoltardata.com/api/user/5/&quot; &quot;https://www.zoltardata.com/api/user/4/&quot; ...</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;  $ public     : logi  TRUE TRUE TRUE TRUE TRUE FALSE ...</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;  $ name       : chr  &quot;COVID-19 Forecasts&quot; &quot;Aggregating Statistical Models and Human Judgment&quot; &quot;COVID-19 Forecasts Viz Test&quot; &quot;Election Forecasts&quot; ...</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;  $ description: chr  &quot;The goal of this repository is to create a standardized set of data on forecasts from experienced teams making &quot;| __truncated__ &quot;This project aims to provide public health officials forecasts of the COVID-19 outbreak using human judgment.\r&quot;| __truncated__ &quot;The goal of this repository is to create a standardized set of data on forecasts from experienced teams making &quot;| __truncated__ &quot;This project stores forecasts from multiple election forecast sites, including FiveThirtyEight and the Economis&quot;| __truncated__ ...</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;  $ home_url   : chr  &quot;https://covid19forecasthub.org&quot; &quot;https://github.com/computationalUncertaintyLab/aggStatModelsAndHumanJudgment_PUBL&quot; &quot;https://covid19forecasthub.org&quot; &quot;https://reichlab.io&quot; ...</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;  $ core_data  : chr  &quot;https://github.com/reichlab/covid19-death-forecasts/tree/master/data-processed&quot; &quot;https://dataverse.harvard.edu/dataverse/aggregating_statistical_models_and_human_judgment&quot; &quot;https://github.com/reichlab/covid19-death-forecasts/tree/master/data-processed&quot; &quot;https://zoltardata.com/&quot; ...</span></span></code></pre></div>
</div>
<div id="get-a-project-to-work-with-and-list-its-info-and-models" class="section level2">
<h2>Get a project to work with and list its info and models</h2>
<p>Let’s start by getting a public project to work with. We will search
the projects list for it by name. Then we will pass its URL to the
<code>project_info()</code> function to get a <code>list</code> of
details, and then pass it to the <code>models()</code> function to get a
<code>data.frame</code> of its models.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>project_url <span class="ot">&lt;-</span> the_projects[the_projects<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;Docs Example Project&quot;</span>, <span class="st">&quot;url&quot;</span>]</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>the_project_info <span class="ot">&lt;-</span> <span class="fu">project_info</span>(zoltar_connection, project_url)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">names</span>(the_project_info)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;           &quot;url&quot;          &quot;owner&quot;        &quot;is_public&quot;    &quot;name&quot;        </span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;description&quot;  &quot;home_url&quot;     &quot;logo_url&quot;     &quot;core_data&quot;    &quot;truth&quot;       </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; [11] &quot;model_owners&quot; &quot;models&quot;       &quot;units&quot;        &quot;targets&quot;      &quot;timezeros&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>the_project_info<span class="sc">$</span>description</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;A template project for learning how to interact with Zoltar. Typically, a full description of the project would go here. You could include narrative details about what seasons are included, what group has provided data, whether the project focuses on real-time or retrospective forecasts.&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>the_models <span class="ot">&lt;-</span> <span class="fu">models</span>(zoltar_connection, project_url)</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="fu">str</span>(the_models)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    1 obs. of  10 variables:</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt;  $ id          : int 139</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt;  $ url         : chr &quot;https://www.zoltardata.com/api/model/139/&quot;</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt;  $ project_url : chr &quot;https://www.zoltardata.com/api/project/41/&quot;</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt;  $ owner_url   : logi NA</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt;  $ name        : chr &quot;docs forecast model&quot;</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt;  $ model_abbr  : chr &quot;docs_mod&quot;</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt;  $ notes       : chr &quot;&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt;  $ description : chr &quot;The example project for the documentation site https://docs.zoltardata.com/ .&quot;</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt;  $ home_url    : chr &quot;https://docs.zoltardata.com/&quot;</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt;  $ aux_data_url: logi NA</span></span></code></pre></div>
<p>There is other project-related information that you can access, such
as its configuration (<code>zoltar_units()</code>,
<code>targets()</code>, and <code>timezeros()</code> - concepts that are
explained at <a href="https://docs.zoltardata.com/">docs.zoltardata.com</a> - and
<code>truth()</code></p>
</div>
<div id="query-a-projects-forecast-data" class="section level2">
<h2>Query a project’s forecast data</h2>
<p>You can query a project’s forecast data using the
<code>submit_query()</code> function. Keep in mind that Zoltar enqueues
long operations like querying and uploading forecasts, which keeps the
site responsive but makes the Zoltar API a little more complicated.
Rather than having the <code>submit_query()</code> function
<em>block</em> until the query is done, you instead get a quick response
in the form of a <code>Job</code> URL that you can pass to the
<code>job_info()</code> function to check its status and find out if the
upload is pending, successfully finished, or failed. (This is called
<em>polling</em> the host to ask the status.) Here we poll every second
using the <code>busy_poll_job()</code> helper function. Then we use the
<code>job_data()</code> function when the query is successfully
completed to get the results as a <code>data.frame</code>.</p>
<blockquote>
<p>Note: You may find the <code>do_zoltar_query()</code> function
helpful, which combines <code>submit_query()</code>,
<code>busy_poll_job()</code>, and <code>job_data()</code> in one
call.</p>
</blockquote>
<p>Putting it together, we’ll show the long way to do it (for reference)
but use <code>do_zoltar_query()</code> to actually run the example:</p>
<!-- show but don't run-->
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;targets&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;pct next week&quot;</span>, <span class="st">&quot;cases next week&quot;</span>), <span class="st">&quot;types&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;point&quot;</span>))</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>job_url <span class="ot">&lt;-</span> <span class="fu">submit_query</span>(zoltar_connection, project_url, <span class="st">&quot;forecasts&quot;</span>, query)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">busy_poll_job</span>(zoltar_connection, job_url)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>the_job_data <span class="ot">&lt;-</span> <span class="fu">job_data</span>(zoltar_connection, job_url)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>the_job_data</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>forecast_data <span class="ot">&lt;-</span> <span class="fu">do_zoltar_query</span>(zoltar_connection, project_url, <span class="st">&quot;forecasts&quot;</span>, <span class="st">&quot;docs_mod&quot;</span>, </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                                 <span class="fu">c</span>(<span class="st">&quot;loc1&quot;</span>, <span class="st">&quot;loc2&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;pct next week&quot;</span>, <span class="st">&quot;cases next week&quot;</span>),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                                 <span class="fu">c</span>(<span class="st">&quot;2011-10-02&quot;</span>, <span class="st">&quot;2011-10-09&quot;</span>, <span class="st">&quot;2011-10-16&quot;</span>), <span class="at">types =</span> <span class="fu">c</span>(<span class="st">&quot;point&quot;</span>, <span class="st">&quot;quantile&quot;</span>))</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>forecast_data</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 × 15</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;   model   timezero   season unit  target class value cat   prob  sample quantile</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;     &lt;dbl&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; 1 docs_m… 2011-10-16 2011-… loc1  pct n… point   2.1 NA    NA    NA       NA    </span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; 2 docs_m… 2011-10-16 2011-… loc2  pct n… point   2   NA    NA    NA       NA    </span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; 3 docs_m… 2011-10-16 2011-… loc2  pct n… quan…   1   NA    NA    NA        0.025</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 4 docs_m… 2011-10-16 2011-… loc2  pct n… quan…   2.2 NA    NA    NA        0.25 </span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; 5 docs_m… 2011-10-16 2011-… loc2  pct n… quan…   2.2 NA    NA    NA        0.5  </span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; 6 docs_m… 2011-10-16 2011-… loc2  pct n… quan…   5   NA    NA    NA        0.75 </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; 7 docs_m… 2011-10-16 2011-… loc2  pct n… quan…  50   NA    NA    NA        0.975</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; 8 docs_m… 2011-10-16 2011-… loc2  cases… point   5   NA    NA    NA       NA    </span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; # ℹ 4 more variables: family &lt;lgl&gt;, param1 &lt;lgl&gt;, param2 &lt;lgl&gt;, param3 &lt;lgl&gt;</span></span></code></pre></div>
<p>Hopefully you’ll see “SUCCESS” eventually printed and then the
resulting data itself.</p>
<blockquote>
<p>Note: Zoltar returns a 404 Not Found error if <code>job_data()</code>
is called on a Job that has no underlying data file (Zoltar saves query
results as temporary files on the server). This can happen for two
reasons: 1) 24 hours has passed (the expiration time for temporary
files) or 2) the Job is not complete and therefore there is no data file
yet. As noted above, you can avoid the latter condition by using
<code>busy_poll_job()</code> to ensure the job is done.</p>
</blockquote>
<blockquote>
<p>Note: Zoltar limits the number of rows a query can return, giving you
an error if they are exceeded. The job’s failure message will indicate
whether this has happened.</p>
</blockquote>
</div>
<div id="query-a-projects-truth-data" class="section level2">
<h2>Query a project’s truth data</h2>
<p>Similarly, querying truth is done by passing a
<code>query_type</code> of <code>&quot;truth&quot;</code>. Further, only the
<code>units</code>, <code>targets</code>, <code>timezeros</code>, and
<code>as_of</code> args are allowed:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>truth_data <span class="ot">&lt;-</span> <span class="fu">do_zoltar_query</span>(zoltar_connection, project_url, <span class="st">&quot;truth&quot;</span>, <span class="cn">NULL</span>, <span class="fu">c</span>(<span class="st">&quot;loc1&quot;</span>, <span class="st">&quot;loc2&quot;</span>),</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                              <span class="fu">c</span>(<span class="st">&quot;pct next week&quot;</span>, <span class="st">&quot;cases next week&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;2011-10-02&quot;</span>, <span class="st">&quot;2011-10-09&quot;</span>, <span class="st">&quot;2011-10-16&quot;</span>),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                              <span class="st">&quot;2020-12-18 12:00:00 UTC&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>truth_data</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 4</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;   timezero   unit  target          value</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 1 2011-10-02 loc1  pct next week    4.54</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; 2 2011-10-02 loc1  cases next week 10   </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; 3 2011-10-09 loc2  pct next week   99.9 </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 4 2011-10-09 loc2  cases next week  3   </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 5 2011-10-16 loc1  pct next week    1   </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; 6 2011-10-16 loc1  cases next week  1</span></span></code></pre></div>
</div>
<div id="get-projects-latest-forecast-ids-and-their-sources" class="section level2">
<h2>Get project’s latest forecast IDs and their sources</h2>
<p>This is a somewhat specialized function that returns the
<code>ID</code> and <code>source</code> of the latest versions of a
project’s forecasts. (Later we may generalize to allow passing specific
columns to retrieve, such as ‘forecast_model_id’, ‘time_zero_id’,
‘issued_at’, ‘created_at’, ‘source’, and ‘notes’.)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>the_latest_forecasts <span class="ot">&lt;-</span> <span class="fu">latest_forecasts</span>(zoltar_connection, project_url)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>the_latest_forecasts</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt;   forecast_id source               </span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;         &lt;int&gt; &lt;chr&gt;                </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 1      109920 docs-predictions.json</span></span></code></pre></div>
</div>
<div id="get-a-model-to-work-with-and-list-its-info-and-forecasts" class="section level2">
<h2>Get a model to work with and list its info and forecasts</h2>
<p>Now let’s work with a particular model, getting its URL by name and
then passing it to the <code>model_info()</code> function to get
details. Then use the <code>forecasts()</code> function to get a
<code>data.frame</code> of that model’s forecasts (there is only one).
Note that obtaining the model’s URL is straightforward because it is
provided in the <code>url</code> column of <code>the_models</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>model_url <span class="ot">&lt;-</span> the_models[the_models<span class="sc">$</span>name <span class="sc">==</span> <span class="st">&quot;docs forecast model&quot;</span>, <span class="st">&quot;url&quot;</span>]</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>the_model_info <span class="ot">&lt;-</span> <span class="fu">model_info</span>(zoltar_connection, model_url)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">names</span>(the_model_info)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;id&quot;           &quot;url&quot;          &quot;project&quot;      &quot;owner&quot;        &quot;name&quot;        </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;abbreviation&quot; &quot;team_name&quot;    &quot;description&quot;  &quot;contributors&quot; &quot;license&quot;     </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [11] &quot;notes&quot;        &quot;citation&quot;     &quot;methods&quot;      &quot;home_url&quot;     &quot;aux_data_url&quot;</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>the_model_info<span class="sc">$</span>name</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;docs forecast model&quot;</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>the_forecasts <span class="ot">&lt;-</span> <span class="fu">forecasts</span>(zoltar_connection, model_url)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="fu">str</span>(the_forecasts)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; &#39;data.frame&#39;:    1 obs. of  12 variables:</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;  $ id                : int 109920</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;  $ url               : chr &quot;https://www.zoltardata.com/api/forecast/109920/&quot;</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  $ forecast_model_url: chr &quot;https://www.zoltardata.com/api/model/139/&quot;</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  $ source            : chr &quot;docs-predictions.json&quot;</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt;  $ timezero_url      : chr &quot;https://www.zoltardata.com/api/timezero/497/&quot;</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt;  $ timezero_date     : Date, format: &quot;2011-10-16&quot;</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt;  $ data_version_date : Date, format: NA</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt;  $ is_season_start   : logi FALSE</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt;  $ created_at        : POSIXct, format: &quot;2024-04-09 17:21:29&quot;</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt;  $ issued_at         : POSIXct, format: &quot;2024-04-09 17:21:29&quot;</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co">#&gt;  $ notes             : chr &quot;&quot;</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co">#&gt;  $ forecast_data_url : chr &quot;https://www.zoltardata.com/api/forecast/109920/data/&quot;</span></span></code></pre></div>
</div>
<div id="finally-download-the-forecasts-data-in-three-formats" class="section level2">
<h2>Finally, download the forecast’s data in three formats</h2>
<p>You can get forecast data using the <code>download_forecast()</code>
function, which returns a nested <code>list</code> format that
corresponds to Zoltar’s native JSON one. That format can be converted to
a CSV-friendly <code>data.frame</code> via
<code>data_frame_from_forecast_data()</code>, which can represent all
prediction types, or
<code>quantile_data_frame_from_forecast_data()</code> for users who are
mainly interested in <code>point</code> and <code>quantile</code> data.
Please see <a href="https://docs.zoltardata.com/">docs.zoltardata.com</a> for forecast
format details.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>forecast_url <span class="ot">&lt;-</span> the_forecasts[<span class="dv">1</span>, <span class="st">&quot;url&quot;</span>]</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>forecast_info <span class="ot">&lt;-</span> <span class="fu">forecast_info</span>(zoltar_connection, forecast_url)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>forecast_data <span class="ot">&lt;-</span> <span class="fu">download_forecast</span>(zoltar_connection, forecast_url)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">length</span>(forecast_data<span class="sc">$</span>predictions)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; [1] 32</span></span></code></pre></div>
<p>As a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>forecast_data_frame <span class="ot">&lt;-</span> <span class="fu">data_frame_from_forecast_data</span>(forecast_data)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">str</span>(forecast_data_frame)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   64 obs. of  12 variables:</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt;  $ unit    : chr  &quot;loc1&quot; &quot;loc1&quot; &quot;loc1&quot; &quot;loc1&quot; ...</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;  $ target  : chr  &quot;Season peak week&quot; &quot;Season peak week&quot; &quot;Season peak week&quot; &quot;Season peak week&quot; ...</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt;  $ class   : chr  &quot;bin&quot; &quot;bin&quot; &quot;bin&quot; &quot;point&quot; ...</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt;  $ value   : chr  NA NA NA &quot;2019-12-22&quot; ...</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt;  $ cat     : chr  &quot;2019-12-15&quot; &quot;2019-12-22&quot; &quot;2019-12-29&quot; NA ...</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt;  $ prob    : chr  &quot;0.01&quot; &quot;0.1&quot; &quot;0.89&quot; NA ...</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt;  $ sample  : chr  NA NA NA NA ...</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt;  $ quantile: chr  NA NA NA NA ...</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt;  $ family  : chr  NA NA NA NA ...</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt;  $ param1  : chr  NA NA NA NA ...</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;  $ param2  : chr  NA NA NA NA ...</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt;  $ param3  : chr  NA NA NA NA ...</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
<p>And just quantile data:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>forecast_data_frame <span class="ot">&lt;-</span> <span class="fu">quantile_data_frame_from_forecast_data</span>(forecast_data)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">str</span>(forecast_data_frame)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; Classes &#39;data.table&#39; and &#39;data.frame&#39;:   21 obs. of  5 variables:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt;  $ location: chr  &quot;loc1&quot; &quot;loc1&quot; &quot;loc1&quot; &quot;loc1&quot; ...</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;  $ target  : chr  &quot;Season peak week&quot; &quot;above baseline&quot; &quot;pct next week&quot; &quot;season severity&quot; ...</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt;  $ type    : chr  &quot;point&quot; &quot;point&quot; &quot;point&quot; &quot;point&quot; ...</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;  $ quantile: chr  NA NA NA NA ...</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;  $ value   : chr  &quot;2019-12-22&quot; &quot;TRUE&quot; &quot;2.1&quot; &quot;mild&quot; ...</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
